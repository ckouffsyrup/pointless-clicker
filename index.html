<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Pointless Clicker — Bits & Prestige</title>
  <style>
    html,body { touch-action: manipulation; }
    body {
      background: #0f0f10;
      color: #eee;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      margin:0;
      padding:20px;
    }
    .container {
      width:100%;
      max-width:420px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:14px;
    }

    #cps { color: #c399ff; font-weight:700; margin-bottom:4px; } /* purple CPS */
    #count { font-size:3rem; margin:6px 0; font-weight:700; color:#fff; text-align:center; }

    .controls {
      display:flex;
      flex-direction:column;
      gap:10px;
      width:100%;
      align-items:center;
    }

    button {
      background: #2e8b57;
      color: #fff;
      border: none;
      border-radius:10px;
      padding:12px 28px;
      font-size:1.05rem;
      cursor:pointer;
      width:80%;
      max-width:320px;
      transition: transform .08s, box-shadow .12s;
      -webkit-tap-highlight-color: transparent;
    }
    button:active { transform: scale(.98); }
    .blue { background:#1976d2; }
    .muted { background:#555; }
    .gold { background: #f0b429; color:#111; font-weight:700; }
    .red { background:#e53935; }
    .purple { background: #7b1fa2; } /* purple style for prestige upgrades button */
    .small { padding:8px 16px; font-size:0.95rem; width:auto; }
    .muted.small { background:#444; color:#ddd; }

    .currents {
      display:flex;
      gap:12px;
      width:100%;
      justify-content:center;
      align-items:center;
      color:#cfcfcf;
      font-size:0.95rem;
      margin-top:6px;
    }
    .currents div { background: rgba(255,255,255,0.03); padding:6px 10px; border-radius:8px; }

    .toast-container {
      position: fixed;
      top: 18px;
      right: 18px;
      display:flex;
      flex-direction:column;
      gap:10px;
      z-index:2000;
    }
    .toast {
      background: rgba(22,22,22,0.96);
      color:#fff;
      border-left: 5px solid #4caf50;
      padding:10px 14px;
      border-radius:8px;
      min-width:220px;
      transform: translateX(150%);
      opacity:0;
      transition: all .1s ease;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      text-align:left;
    }
    .toast.show { transform: translateX(0); opacity:1; }
    .toast-title { font-weight:700; color:#4caf50; margin-bottom:4px; }
    .toast.gold { border-left-color: gold; }
    .toast.gold .toast-title { color:gold; }

    .panel {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%,-50%) scale(.98);
      width:92%;
      max-width:420px;
      max-height:80vh;
      overflow:auto;
      background:#161616;
      border-radius:12px;
      border:2px solid rgba(255,255,255,0.03);
      padding:12px;
      display:none;
      z-index:1500;
      box-shadow: 0 20px 60px rgba(0,0,0,0.7);
    }
    
    .panel.show { display:block; animation: pop .18s ease both; }
    @keyframes pop { from { opacity:0; transform:translate(-50%,-50%) scale(.96)} to { opacity:1; transform:translate(-50%,-50%) scale(1)} }

    .panel h2 { margin:8px 0; color:#4caf50; text-align:center; }
    .panel .close { float:right; background:#e53935; color:#fff; padding:6px 10px; border-radius:8px; cursor:pointer; }

    .achievement { background:#1b1b1b; padding:10px 12px; border-radius:8px; border-left:5px solid #444; margin:8px 0; color:#ddd;}
    .achievement.unlocked { border-left-color:#4caf50; color:#fff; background:#222; }
    .achievement.secret.unlocked { border-left-color:gold; background:#2f2307; color:#fff; box-shadow: inset 0 0 18px rgba(255,200,0,0.03); }
    .achievement .title { font-weight:700; margin-bottom:6px; }
    .no-items { color:#999; text-align:center; font-style:italic; padding:12px 6px; }

    .upgrades { display:flex; flex-direction:column; gap:10px; }
    .upgrade { display:flex; justify-content:space-between; align-items:center; gap:8px; background:#191919; padding:10px; border-radius:8px; }
    .upgrade .meta { text-align:left; }
    .upgrade .meta .name { font-weight:700; color:#ffd; }
    .upgrade button { padding:8px 12px; }

    .stats-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:8px; margin-top:8px; }
    .stat { background:#171717; padding:10px; border-radius:8px; text-align:center; color:#ddd; }

    footer { margin-top:8px; color:#777; font-size:12px; text-align:center; }

    .qbits-upgrade { border-left: 5px solid #7b1fa2; } /* Purple accent for QBits upgrades */
    .qbits-upgrade .name { color: #bb86fc; } /* Light purple text */
    .qbits-indicator { background: rgba(123, 31, 162, 0.12); padding:6px 10px; border-radius:8px; } /* Qbits indicator background */

    .purple-btn { background:#7b1fa2; color:#fff; font-weight:700; border-radius:10px; padding:12px 28px; width:80%; max-width:320px; }

    /* responsive adjustments */
    @media (max-width:420px) {
      button { width:88%; }
      .controls { gap:8px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="cps">CPS: 0</div>
    <div id="count">0</div>

    <div class="controls">
      <button id="clicker" style="font-size:1.35rem;padding:14px 24px;">Click Me</button>
      <button id="achBtn" class="blue">Achievements</button>
      <button id="upgBtn" class="gold">Upgrades</button>
      <button id="prestigeUpgBtn" class="purple-btn" style="display:inline-block;">Prestige Upgrades</button>
      <button id="statsBtn" class="muted">Stats</button>
      <button id="prestigeBtn" class="gold" style="display:none;">Prestige</button>
      <button id="resetBtn" class="red">Reset</button>

      <div class="currents" style="margin-top:6px;">
        <div id="bitsCur">Bits: 0</div>
        <div id="bitsPerClick">Bits/Click: 1</div>
        <div id="multCur">x1.00</div>
        <div id="qbitsCur" class="qbits-indicator">QBits: 0</div>
      </div>
    </div>

    <footer>Pointless Clicker — Bits, upgrades & prestige</footer>
  </div>

  <div class="toast-container" id="toastContainer"></div>

  <!-- Achievements panel -->
  <div id="achPanel" class="panel" aria-hidden="true">
    <button id="closeAch" class="close">Close</button>
    <h2>Achievements</h2>
    <div id="achList"></div>
  </div>

  <!-- Upgrades panel -->
  <div id="upgPanel" class="panel" aria-hidden="true">
    <button id="closeUpg" class="close">Close</button>
    <h2>Upgrades (Bits shop)</h2>
    <div class="upgrades" id="upgList"></div>
  </div>

  <!-- Prestige Upgrades panel (dark gray, purple accents) -->
  <div id="prestigePanel" class="panel" aria-hidden="true">
    <button id="closePrestige" class="close">Close</button>
    <h2 style="color:#bb86fc; text-align:center;">Prestige Upgrades (QBits)</h2>
    <div id="prestigeInfo" style="text-align:center;color:#ddd;margin-bottom:8px;">Permanent upgrades purchased with QBits</div>
    <div class="upgrades" id="prestigeList"></div>
  </div>

  <!-- Stats panel -->
  <div id="statsPanel" class="panel" aria-hidden="true">
    <button id="closeStats" class="close">Close</button>
    <h2>Stats</h2>
    <div class="stats-grid">
      <div class="stat"><div style="font-size:18px;font-weight:700" id="statTotal">0</div><div>Total Clicks</div></div>
      <div class="stat"><div style="font-size:18px;font-weight:700" id="statBits">0</div><div>Total Bits</div></div>
      <div class="stat"><div style="font-size:18px;font-weight:700" id="statPrestige">0</div><div>Prestige</div></div>
      <div class="stat"><div style="font-size:18px;font-weight:700" id="statUpgrades">0</div><div>Upgrades Owned</div></div>
    </div>
    <div style="margin-top:10px;">
      <div style="text-align:center;color:#bbb">Playtime</div>
      <div id="statPlaytime" style="text-align:center;color:#ddd;margin-top:6px">0s</div>
    </div>
  </div>

<script>
/* ------------------------------
   STORAGE & INITIAL STATE
   ------------------------------ */
const QBITS_PER_PRESTIGE = 2; // flat 2 QBits per prestige (per your request)

let count = parseFloat(localStorage.getItem('count')) || 0;
let totalClicks = parseFloat(localStorage.getItem('totalClicks')) || 0;
let bits = parseFloat(localStorage.getItem('bits')) || 0;
let totalBitsEarned = parseFloat(localStorage.getItem('totalBitsEarned')) || 0;
let bitsSpent = parseFloat(localStorage.getItem('bitsSpent')) || 0;
let unlocked = JSON.parse(localStorage.getItem('unlockedAchievements')) || [];
let prestigeCount = parseInt(localStorage.getItem('prestigeCount')) || 0;
let firstSeen = parseInt(localStorage.getItem('firstSeen')) || Date.now();
let savedPlaytime = parseInt(localStorage.getItem('savedPlaytime')) || 0;
let lastPlayed = parseInt(localStorage.getItem('lastPlayed')) || Date.now();
let sessionStart = Date.now();
let offlineClicksEarned = parseInt(localStorage.getItem('offlineClicksEarned')) || 0;

// QBits & prestige upgrades persisted
let qbits = (localStorage.getItem('qbits') !== null) ? parseFloat(localStorage.getItem('qbits')) : null;
let prestigeUpgrades = JSON.parse(localStorage.getItem('prestigeUpgrades') || '{}');

/* If qbits were never stored but player already had prestige levels, award them retroactively (only once) */
if (qbits === null) {
  qbits = prestigeCount > 0 ? prestigeCount * QBITS_PER_PRESTIGE : 0;
  // store to avoid double-awarding on subsequent loads
  localStorage.setItem('qbits', String(qbits));
  localStorage.setItem('prestigeUpgrades', JSON.stringify(prestigeUpgrades));
}

/* upgrades structure */
let upgrades = JSON.parse(localStorage.getItem('upgrades')) || {
  finger: 0,
  mouse: 0,
  energy: 0,
  magnet: 0,
  turbo: 0,
  factory: 0,
  bank: 0
};

/* UI */
const countEl = document.getElementById('count');
const cpsEl = document.getElementById('cps');
const clickBtn = document.getElementById('clicker');
const achBtn = document.getElementById('achBtn');
const upgBtn = document.getElementById('upgBtn');
const prestigeUpgBtn = document.getElementById('prestigeUpgBtn');
const statsBtn = document.getElementById('statsBtn');
const prestigeBtn = document.getElementById('prestigeBtn');
const resetBtn = document.getElementById('resetBtn');

const bitsCur = document.getElementById('bitsCur');
const bitsPerClickEl = document.getElementById('bitsPerClick');
const multCur = document.getElementById('multCur');
const qbitsCur = document.getElementById('qbitsCur');

const toastContainer = document.getElementById('toastContainer');

const achPanel = document.getElementById('achPanel');
const achList = document.getElementById('achList');
const closeAch = document.getElementById('closeAch');

const upgPanel = document.getElementById('upgPanel');
const upgList = document.getElementById('upgList');
const closeUpg = document.getElementById('closeUpg');

const prestigePanel = document.getElementById('prestigePanel');
const prestigeList = document.getElementById('prestigeList');
const closePrestige = document.getElementById('closePrestige');

const statsPanel = document.getElementById('statsPanel');
const closeStats = document.getElementById('closeStats');
const statTotal = document.getElementById('statTotal');
const statBits = document.getElementById('statBits');
const statPrestige = document.getElementById('statPrestige');
const statUpgrades = document.getElementById('statUpgrades');
const statPlaytime = document.getElementById('statPlaytime');

/* ------------------------------
   ACHIEVEMENTS (you said you'd paste the long list yourself; kept current small list)
   ------------------------------ */
const achievements = {
  "1": { text: "Ah yes, the first click. So the journey begins.", secret:false },
  "5": { text: "You've clicked... once? Twice? Eh..", secret:false },
  "10": { text: "You’ve clicked 10 times. Mildly impressive.", secret:false },
  "15": { text: "Getting the hang of it I see.", secret:false },
  "25": { text: "Is your finger okay?", secret:false },
  "42": { text: "42 clicks — the answer to everything.", secret:false },
  "69": { text: "Nice", secret:false },
  "100": { text: "You clearly have nothing better to do.", secret:false },
  "200": { text: "Really...", secret:false },
  "250": { text: "You’re kinda scary with this speed.", secret:false },
  "300": { text: "You might have a mild obsession.", secret:false },
  "333": { text: "Triple Threat, oh no.", secret:false },
  "420": { text: "Blaze it.", secret:false },
  "500": { text: "Your dedication is both admirable and concerning.", secret:false },
  "666": { text: "Uh oh… something feels evil.", secret:false },
  "6969": { text: "Nice... again.", secret:true },           // secret example
  "750": { text: "Stop. Just... stop.", secret:false },
  "800": { text: "Almost to 1000, proud of yourself?", secret:false },
  "900": { text: "Okay, this is a little much..", secret:false },
  "1000": { text: "You have reached enlightenment. Stop now. Or don’t.", secret:false },
  "1111": { text: "You like patterns, huh?", secret:false },
  "1200": { text: "Why are you still here?", secret:false },
  "1234": { text: "Sequential! Wow.", secret:false },
  "1337": { text: "Leet clicker.", secret:false },
  "1500": { text: "You clearly have no social life.. oof", secret:false },
  "2000": { text: "Are you okay?", secret:false },
  "2500": { text: "Your mouse/screen is crying.", secret:false },
  "3000": { text: "Do you not have a life?", secret:false },
  "3500": { text: "Your mouse deserves hazard pay.", secret:false },
  "4000": { text: "Someone call a mental institute.. please", secret:false },
  "4040": { text: "Achievement not found.", secret:false },
  "4500": { text: "You could've baked a cake by now you know.", secret:false },
  "5000": { text: "You might need help.", secret:false },
  "5500": { text: "Yeah, you need help..", secret:false },
  "6000": { text: "Please bro, why are you still here...", secret:false },
  "6500": { text: "Your mouse/finger deserves a break.. jeez", secret:false },
  "7000": { text: "Go to bed or something.", secret:false },
  "7500": { text: "Okay, you’ve proven your point.", secret:false },
  "8000": { text: "Why.", secret:false },
  "8500": { text: "Achievement hunting like a pro.", secret:false },
  "9000": { text: "I'm telling your mom..", secret:false },
  "9500": { text: "You really have no life huh?", secret:false },
  "10000": { text: "Touch grass, please.", secret:false },
  "10001": { text: "Secret Achievement unlocked. You good?", secret:true },
  "11000": { text: "Double digits in the thousands? Wow.", secret:false },
  "12000": { text: "The universe is judging you...", secret:false },
  "12345": { text: "Counted sequentially, didn’t you?", secret:true },
  "15000": { text: "You may have broken reality.", secret:false },
  "17000": { text: "You've got to do something else soon right?", secret:false},
  "18500": { text: "Jeez. You really need a life.", secret:true},
  "20000": { text: "Clicking is life now, isn't it?", secret:false },
  "25000": { text: "You're officially a legend... or maybe insane. Idk yet...", secret:false },
  "30000": { text: "You're breaking records no one tracks..", secret:false },
  "35000": { text: "Do you really have nothing to do rn?", secret:false },
  "40000": { text: "I get it bro. You can calm down now...", secret:false },
  "45000": { text: "Fuck my eyes - Colton", secret:false },
  "50000": { text: "Again, just why?", secret:false },
  "55000": { text: "So uh, when you stopping?", secret:false },
  "69696": { text: "Ultimate nice achieved.", secret:true },
  "70000": { text: "You really gotta stop man.", secret:false},
  "80000": { text: "This is getting out of hand.", secret:false},
  "90000": { text: "Soooo... When we stopping???", secret:false},
  "99999": { text: "How did you even get here?", secret:true},
  "100000": { text: "Do you always no-life games like this?", secret:false},
  "120000": { text: "What's the point? Are you THAT bored?", secret:false},
  "150000": { text: "I'm not impressed anymore...", secret:false},
  "200000": { text: "Any minute now you'll give up.... right?", secret:true},
  "250000": { text: "Do you get bullied?", secret:false},
  "300000": { text: "You should.", secret:false},
  "500000": { text: "Just give up already.", secret:false},
  "700000": { text: "You really are annoying", secret:true},
  "1000000": { text: "I hope you get/got bullied in school.", secret:false},
  "1500000": { text: "You really need to get a life..", secret:false},
  "2000000": { text: "Mhm. Just keeping wasting your life.", secret:false},
  "3000000": { text: "Go do something productive man.", secret:false},
  "4000000": { text: "You need to stop. Like actually..", secret:true},
  "4040404": { text: "Really weird error message here..", secret:true},
  "5000000": { text: "Really....", secret:false},
  "6000000": { text: "You must actually be bored.", secret:false},
  "7000000": { text: "Time to shower bro...", secret:true},
  "8000000": { text: "Please... just stop..", secret:false},
  "9000000": { text: ".....", secret:false},
  "10000000": { text: "Point's been proven dude.. get off.", secret:false},
  "11000000": { text: "Your hand must be numb by now.", secret:false },
  "12000000": { text: "Even your computer/phone is tired of you.", secret:false },
  "13000000": { text: "Stop. Get some help.", secret:false },
  "14000000": { text: "You’re still doing this? Why?", secret:false },
  "15000000": { text: "The definition of insanity.", secret:false },
  "16000000": { text: "I bet your mouse/screen cries itself to sleep.", secret:false },
  "17000000": { text: "No one’s impressed. Not even me.", secret:false },
  "18000000": { text: "This isn’t an achievement. It’s a cry for help.", secret:false },
  "19000000": { text: "Bro thinks he’s in a montage.", secret:false },
  "20000000": { text: "Congrats. You’ve wasted a measurable portion of your life.", secret:false },
  "21000000": { text: "Touching grass is free you know.", secret:false },
  "22000000": { text: "How’s your wrist/fingers feeling?", secret:false },
  "23000000": { text: "You’re the reason mice have short lifespans.", secret:false },
  "24000000": { text: "Go outside and blink at the sun or something.", secret:false },
  "25000000": { text: "Even AI’s judging you now.", secret:false },
  "26000000": { text: "Do you even *remember* why you started clicking?", secret:false },
  "27000000": { text: "This is impressive in a deeply concerning way.", secret:false },
  "28000000": { text: "Your persistence is terrifying.", secret:false },
  "29000000": { text: "You’ve unlocked early onset carpal tunnel!", secret:false },
  "30000000": { text: "Do you just enjoy pain?", secret:false },
  "33333333": { text: "The devil’s favorite number. Fitting.", secret:true },
  "35000000": { text: "Still going huh? Must be lonely.", secret:false },
  "36000000": { text: "You’re the final boss of boredom.", secret:false },
  "37000000": { text: "Your clicks echo in the void.", secret:false },
  "38000000": { text: "This isn’t dedication. It’s obsession.", secret:false },
  "39000000": { text: "You’re one click closer to insanity.", secret:false },
  "40000000": { text: "Even the code’s tired of you.", secret:false },
  "42000000": { text: "Blaze it. Again. Still not cool though.", secret:true },
  "43000000": { text: "At this point, you’re just farming pain.", secret:false },
  "44000000": { text: "There’s no reward. Just regret.", secret:false },
  "45000000": { text: "Hope your mouse/phone is under warranty.", secret:false },
  "46000000": { text: "You’re the villain in your own story.", secret:false },
  "47000000": { text: "I’ve seen clickbots with more self-respect.", secret:false },
  "48000000": { text: "It’s not too late to close the page.", secret:false },
  "49000000": { text: "Stop. You’re scaring me.", secret:true },
  "50000000": { text: "Half of 100 million. You proud of yourself?", secret:false },
  "55000000": { text: "Imagine explaining this to your future kids.", secret:false },
  "60000000": { text: "You’ve unlocked… shame.", secret:false },
  "66666666": { text: "Welcome back, demon clicker.", secret:true },
  "70000000": { text: "You’ve out-clicked your own potential.", secret:false },
  "75000000": { text: "I can’t even insult you anymore. It’s just sad.", secret:false },
  "80000000": { text: "Do you even blink anymore?", secret:false },
  "85000000": { text: "Your sanity is a distant memory.", secret:false },
  "90000000": { text: "Even I’m starting to feel bad for you.", secret:false },
  "95000000": { text: "You’re what scientists call a 'problem'.", secret:false },
  "99999999": { text: "You’ve reached peak uselessness.", secret:true },
  "100000000": { text: "A hundred million clicks. Congratulations. You’ve achieved nothing.", secret:false },
  "111111111": { text: "The universe weeps for you.", secret:true },
  "120000000": { text: "Are you trying to break reality?", secret:false },
  "150000000": { text: "You’re officially a legend... of regret.", secret:false },
  "200000000": { text: "I stopped caring ages ago.", secret:false },
  "250000000": { text: "I hope your finger evolves into a stylus.", secret:false },
  "300000000": { text: "You’re not winning. No one is.", secret:false },
  "400000000": { text: "Even your reflection’s disappointed.", secret:false },
  "500000000": { text: "Half a billion clicks. Therapy’s cheaper, y’know.", secret:false },
  "600000000": { text: "You’ve become one with the click.", secret:true },
  "750000000": { text: "This is no longer a game. It’s a lifestyle.", secret:false },
  "900000000": { text: "You’re a legend no one wanted.", secret:false },
  "999999999": { text: "You broke the matrix for nothing.", secret:true },
  "1000000000": { text: "1 BILLION clicks. Seek professional help.", secret:false },
  "1100000000": { text: "Your mouse/screen is crying in shame.", secret:false },
  "1110000000": { text: "Even your chair judges you.", secret:false },
  "1120000000": { text: "You’re basically an internet gremlin now.", secret:false },
  "1130000000": { text: "Stop. Literally just stop.", secret:false },
  "1140000000": { text: "You’ve officially peaked in pointlessness.", secret:false },
  "1150000000": { text: "Do you even remember what sunlight looks like?", secret:false },
  "1160000000": { text: "Your family wonders if you still exist.", secret:false },
  "1170000000": { text: "You might be the first human click-caveman.", secret:false },
  "1180000000": { text: "Imagine explaining this to a therapist.", secret:false },
  "1190000000": { text: "The void judges you. And it’s disappointed.", secret:false },
  "1200000000": { text: "Your productivity has gone extinct.", secret:false },
  "1210000000": { text: "Congratulations. You’ve become a cautionary tale.", secret:false },
  "1220000000": { text: "Even AI refuses to simulate your dedication.", secret:false },
  "1230000000": { text: "This is no longer clicking. This is suffering.", secret:false },
  "1240000000": { text: "The universe is considering intervention.", secret:false },
  "1250000000": { text: "Every click increases your regret exponentially.", secret:false },
  "1260000000": { text: "Do you even know who you are anymore?", secret:false },
  "1270000000": { text: "Your neighbors filed a missing person report on your social life.", secret:false },
  "1280000000": { text: "You’re single-handedly redefining boredom.", secret:false },
  "1290000000": { text: "The mouse/screen store called—they want their warranty back.", secret:false },
  "1300000000": { text: "You’re a legend. A disappointing legend that is.", secret:false },
  "1310000000": { text: "Even the internet is judging your choices.", secret:false },
  "1320000000": { text: "Your shadow is trying to escape.", secret:false },
  "1330000000": { text: "Secret Unlocked: You’ve officially lost your mind.", secret:true },
  "1340000000": { text: "People are writing eulogies for your free time.", secret:false },
  "1350000000": { text: "Your hand has filed a formal complaint.", secret:false },
  "1360000000": { text: "Your reflection is crying silently.", secret:false },
  "1370000000": { text: "Even clickbots pity you now.", secret:false },
  "1380000000": { text: "Stop. Your mouse/screen is begging for mercy.", secret:false },
  "1390000000": { text: "You’re an internet ghost haunting your own life.", secret:false },
  "1400000000": { text: "The phrase 'pointless obsession' was invented for you.", secret:false },
  "1410000000": { text: "You’re officially a meme of despair.", secret:false },
  "1420000000": { text: "Secret Unlocked: Your life choices are a cautionary tale.", secret:true },
  "1430000000": { text: "Your neighbors are planning an intervention.", secret:false },
  "1440000000": { text: "You’ve made the void look productive.", secret:false },
  "1450000000": { text: "All your achievements are now regrets.", secret:false },
  "1460000000": { text: "Even the internet is exhausted on your behalf.", secret:false },
  "1470000000": { text: "Stop. You’re embarrassing yourself to AI.", secret:false },
  "1480000000": { text: "Your mouse/screen has filed for divorce.", secret:false },
  "1490000000": { text: "You’re a legend of misery and regret.", secret:false },
  "1500000000": { text: "Secret Unlocked: The universe facepalms.", secret:true },
  "1550000000": { text: "Imagine explaining this to future historians.", secret:false },
  "1600000000": { text: "You’ve broken boredom. It’s now self-aware.", secret:false },
  "1650000000": { text: "Your life is now a footnote in the annals of despair.", secret:false },
  "1700000000": { text: "Even your chair refuses to support you.", secret:false },
  "1750000000": { text: "Stop. Just… put the mouse/phone down.", secret:false },
  "1800000000": { text: "The number of clicks is directly proportional to your sadness.", secret:false },
  "1850000000": { text: "Secret Unlocked: You’re a cautionary legend of nothingness.", secret:true },
  "1900000000": { text: "Congratulations. You are officially insane.", secret:false },
  "2000000000": { text: "Two billion clicks. Therapist’s inbox full.", secret:false },
};

/* ------------------------------
   UTILS & BALANCE
   ------------------------------ */
function getClickPrestigeMultiplier() {
  if (prestigeCount <= 0) return 1;
  return 1 + Math.pow(prestigeCount * 0.1, 1.3);
}
function getBitsPrestigeMultiplier() {
  return Math.pow(1.15, prestigeCount);
}

/* Prestige upgrade effects helpers (read from prestigeUpgrades) */
function prestigeLevel(id) { return prestigeUpgrades[id] || 0; }

/* Base bits per click includes Bit Bank, Quantum Hands (flat), and global prestige multiplier */
function getBaseBitsPerClick() {
  let base = 1 + (upgrades.bank || 0) * 0.2;
  base += (prestigeLevel('quantumHands') || 0) * 0.5; // quantumHands adds flat +0.5 per level
  let mult = getBitsPrestigeMultiplier();
  if (upgrades.magnet && upgrades.magnet > 0) mult *= 2;
  // quantumProcessor adds multiplicative bits-per-click (10% per level)
  mult *= 1 + (prestigeLevel('quantumProcessor') || 0) * 0.10;
  return base * mult;
}

/* Click power uses finger/mouse/turbo and prestige multiplier */
function getClickPower() {
  let base = 1;
  base += (upgrades.finger || 0) * 0.1;
  base += (upgrades.mouse || 0) * 0.25;
  base += (upgrades.turbo || 0) * 0.5;
  // magnet increases click multiplier slightly? keep as earlier design (was used in bits multiplier)
  return base * getClickPrestigeMultiplier();
}

function getAutoClicksPerSec() {
  return (upgrades.energy || 0) * 1 + (upgrades.factory || 0) * 5;
}
function costFor(levelBase, lvl, scale=1.5) {
  return Math.ceil(levelBase * Math.pow(scale, lvl));
}
function fmt(n) { return Math.floor(n).toLocaleString(); }
function fmtFloat(n, digits=2) { return Number(n).toFixed(digits); }

/* ------------------------------
   SHOP (regular bits upgrades)
   ------------------------------ */
const shop = [
  { id:'finger', name:'Finger Strength', desc:'+0.1 click power per level', baseCost:50 },
  { id:'mouse',  name:'Fancy Mouse', desc:'+0.25 click power per level', baseCost:200 },
  { id:'energy', name:'Energy Drink', desc:'+1 auto-click/sec per level', baseCost:250 },
  { id:'turbo', name:'Turbo Glove', desc:'+0.5 click power per level', baseCost:1000 },
  { id:'factory', name:'Auto Factory', desc:'+5 auto-click/sec per level', baseCost:2500 },
  { id:'bank', name:'Bit Bank', desc:'+0.2 bits per click per level', baseCost:1500 },
  { id:'magnet', name:'Bit Magnet (secret)', desc:'Double Bits gain (one-time, unlocks at 5,000 bits this run)', baseCost:5000, secret:true, oneTime:true }
];

/* ------------------------------
   PRESTIGE SHOP (permanent QBits upgrades)
   baseCost in QBits; costs scale with level.
   ------------------------------ */
const prestigeShop = [
  { id: 'quantumProcessor', name: 'Quantum Processor', desc: '+10% bits per click per level', baseCost: 2, type:'mult', value:0.10 },
  { id: 'timeDistorter',    name: 'Time Distorter',    desc: '+25% offline gain per level',     baseCost: 3, type:'offline', value:0.25 },
  { id: 'quantumHands',     name: 'Quantum Hands',     desc: '+0.5 flat bits per click per level', baseCost: 2, type:'flat', value:0.5 }
];

/* ------------------------------
   TOASTS
   ------------------------------ */
function showToast(title, message, secret=false) {
  const t = document.createElement('div');
  t.className = 'toast' + (secret ? ' gold' : '');
  t.innerHTML = `<div class="toast-title">${title}</div><div>${message}</div>`;
  toastContainer.appendChild(t);
  requestAnimationFrame(()=> t.classList.add('show'));
  setTimeout(()=> {
    t.classList.remove('show');
    setTimeout(()=> t.remove(), 150);
  }, 3200);
}

/* ------------------------------
   SAVE helpers
   ------------------------------ */
function saveAll() {
  localStorage.setItem('count', String(count));
  localStorage.setItem('totalClicks', String(totalClicks));
  localStorage.setItem('bits', String(bits));
  localStorage.setItem('totalBitsEarned', String(totalBitsEarned));
  localStorage.setItem('bitsSpent', String(bitsSpent));
  localStorage.setItem('unlockedAchievements', JSON.stringify(unlocked));
  localStorage.setItem('prestigeCount', String(prestigeCount));
  localStorage.setItem('firstSeen', String(firstSeen));
  localStorage.setItem('savedPlaytime', String(savedPlaytime + (Date.now() - sessionStart)));
  localStorage.setItem('lastPlayed', String(Date.now()));
  localStorage.setItem('offlineClicksEarned', String(offlineClicksEarned));
  localStorage.setItem('upgrades', JSON.stringify(upgrades));
  localStorage.setItem('qbits', String(qbits));
  localStorage.setItem('prestigeUpgrades', JSON.stringify(prestigeUpgrades));
}

/* ------------------------------
   ACHIEVEMENTS MANAGEMENT
   ------------------------------ */
function autoUnlockExisting() {
  const cur = Math.floor(count);
  let changed = false;
  Object.keys(achievements).forEach(k=>{
    const thresh = parseInt(k);
    if (cur >= thresh && !unlocked.includes(k)) {
      unlocked.push(k);
      const secret = achievements[k].secret === true;
      showToast('Achievement Earned!', achievements[k].text, secret);
      changed = true;
    }
  });
  if (changed) saveUnlocked();
}
function saveUnlocked() { localStorage.setItem('unlockedAchievements', JSON.stringify(unlocked)); }

function updateAchievementsPanel() {
  achList.innerHTML = '';
  let shownAny = false;
  const keys = Object.keys(achievements).map(k=>parseInt(k)).sort((a,b)=>a-b);
  for (const k of keys) {
    const key = String(k);
    const info = achievements[key];
    if (info.secret && !unlocked.includes(key)) continue;
    const div = document.createElement('div');
    div.className = 'achievement';
    if (unlocked.includes(key)) {
      if (info.secret) div.classList.add('secret','unlocked');
      else div.classList.add('unlocked');
      const title = info.secret ? 'Secret Achievement' : `Clicks: ${key}`;
      div.innerHTML = `<div class="title">${title}</div><div>${info.text}</div>`;
    } else {
      div.innerHTML = `<div class="title">???</div><div>???</div>`;
    }
    achList.appendChild(div);
    shownAny = true;
  }
  if (!shownAny) achList.innerHTML = `<div class="no-items">No achievements unlocked yet.</div>`;
}

/* ------------------------------
   SHOP RENDER & BUY (regular bits shop)
   ------------------------------ */
function renderShopInner() {
  upgList.innerHTML = '';
  for (const item of shop) {
    const lvl = upgrades[item.id] || 0;
    const price = costFor(item.baseCost, lvl, 1.55);
    const div = document.createElement('div');
    div.className = 'upgrade';

    // magnet locked message
    if (item.id === 'magnet' && (bits < 5000 && (upgrades.magnet || 0) === 0)) {
      div.innerHTML = `
        <div class="meta">
          <div class="name">${item.name}</div>
          <div style="font-size:0.9rem;color:#ccc">${item.desc}</div>
          <div style="font-size:0.85rem;color:#aaa">Locked until you have 5,000 bits this run</div>
        </div>
        <div style="text-align:right;color:#999">Hidden</div>
      `;
    } else {
      div.innerHTML = `
        <div class="meta">
          <div class="name">${item.name}${item.oneTime && lvl>0 ? ' (owned)' : ''}</div>
          <div style="font-size:0.9rem;color:#ccc">${item.desc}</div>
          <div style="font-size:0.85rem;color:#aaa">Level: ${lvl}</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
          <div style="font-weight:700">${price.toLocaleString()} bits</div>
          <button class="buy-btn small" data-id="${item.id}" ${ (item.oneTime && lvl>0) ? 'disabled' : '' }>${ (item.oneTime && lvl>0) ? 'Owned' : 'Buy' }</button>
        </div>
      `;
    }

    upgList.appendChild(div);
  }

  document.querySelectorAll('.buy-btn').forEach(btn=>{
    btn.onclick = ()=> {
      const id = btn.getAttribute('data-id');
      buyUpgrade(id);
    };
  });
}

function buyUpgrade(id) {
  const item = shop.find(s=>s.id===id);
  if (!item) return;
  const lvl = upgrades[id] || 0;
  const price = costFor(item.baseCost, lvl, 1.55);
  if (bits < price) { showToast('Not enough Bits', `You need ${price} bits.`); return; }
  bits -= price;
  bitsSpent += price;
  if (item.oneTime) upgrades[id] = 1;
  else upgrades[id] = lvl + 1;
  if (id === 'energy' || id === 'factory') startAutoClicker();
  saveAll();
  renderShopInner();
  refreshUI();
  showToast('Purchased', `${item.name} purchased!`);
}

/* ------------------------------
   RENDER PRESTIGE (QBits) SHOP
   ------------------------------ */
function prestigeCostForLevel(item, lvl) {
  // cost scaling: baseCost * 1.8^lvl (rounded up)
  return Math.ceil(item.baseCost * Math.pow(1.8, lvl));
}

function renderPrestigeShop() {
  prestigeList.innerHTML = '';
  for (const item of prestigeShop) {
    const lvl = prestigeUpgrades[item.id] || 0;
    const nextCost = prestigeCostForLevel(item, lvl);
    const div = document.createElement('div');
    div.className = 'upgrade qbits-upgrade';
    const currentBonusText = (() => {
      if (item.type === 'mult') return `+${(lvl * item.value * 100).toFixed(0)}% bits/click`;
      if (item.type === 'flat') return `+${(lvl * item.value).toFixed(2)} flat bits/click`;
      if (item.type === 'offline') return `+${(lvl * item.value * 100).toFixed(0)}% offline gain`;
      return '';
    })();
    div.innerHTML = `
      <div class="meta">
        <div class="name">${item.name} (Lv. ${lvl})</div>
        <div style="font-size:0.9rem;color:#ccc">${item.desc}</div>
        <div style="font-size:0.85rem;color:#aaa">${currentBonusText}</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
        <div style="font-weight:700">${nextCost} QBits</div>
        <button class="buy-qbit-btn small" data-id="${item.id}" ${ qbits < nextCost ? 'disabled' : '' } style="background:#7b1fa2;color:#fff;border:none;border-radius:8px;padding:6px 10px;">Buy</button>
      </div>
    `;
    prestigeList.appendChild(div);
  }

  document.querySelectorAll('.buy-qbit-btn').forEach(btn=>{
    btn.onclick = ()=> {
      const id = btn.getAttribute('data-id');
      buyPrestigeUpgrade(id);
    };
  });
}

/* ------------------------------
   BUY PRESTIGE UPGRADE
   ------------------------------ */
function buyPrestigeUpgrade(id) {
  const item = prestigeShop.find(s => s.id === id);
  if (!item) return;
  const lvl = prestigeUpgrades[id] || 0;
  const cost = prestigeCostForLevel(item, lvl);
  if (qbits < cost) { showToast('Not enough QBits', `You need ${cost} QBits.`); return; }
  qbits -= cost;
  prestigeUpgrades[id] = lvl + 1;
  saveAll();
  renderPrestigeShop();
  refreshUI();
  showToast('Quantum Upgrade!', `${item.name} upgraded to level ${prestigeUpgrades[id]}.`, true);
}

/* ------------------------------
   AUTO-CLICKER (live)
   ------------------------------ */
let autoInterval = null;
function startAutoClicker() {
  if (autoInterval) return;
  autoInterval = setInterval(()=>{
    const perSec = getAutoClicksPerSec();
    if (perSec <= 0) return;
    const gained = perSec * getClickPower();
    count += gained;
    totalClicks += gained;
    const bitsGained = perSec * getBaseBitsPerClick();
    bits += bitsGained;
    totalBitsEarned += bitsGained;
    saveAll();
    checkAchievementsAfterIncrement();
    refreshUI();
  }, 1000);
}
function stopAutoClicker() {
  if (!autoInterval) return;
  clearInterval(autoInterval);
  autoInterval = null;
}

/* ------------------------------
   CPS (Clicks Per Second) sampling
   ------------------------------ */
const cpsSamples = []; // store recent totalClicks samples
const CPS_WINDOW = 5; // seconds
setInterval(()=>{
  cpsSamples.push(totalClicks);
  if (cpsSamples.length > CPS_WINDOW) cpsSamples.shift();
  if (cpsSamples.length >= 2) {
    const oldest = cpsSamples[0];
    const newest = cpsSamples[cpsSamples.length-1];
    const seconds = cpsSamples.length - 1;
    const cps = (newest - oldest) / seconds;
    cpsEl.textContent = `CPS: ${fmtFloat(cps,2)}`;
  } else {
    cpsEl.textContent = `CPS: 0`;
  }
}, 1000);

/* ------------------------------
   UI REFRESH
   ------------------------------ */
function getPrestigeCost() {
  return 10000 + prestigeCount * 10000; // increases by 10k each prestige
}

function refreshUI() {
  countEl.textContent = fmt(count);
  bitsCur.textContent = `Bits: ${fmt(bits)}`;
  bitsPerClickEl.textContent = `Bits/Click: ${fmtFloat(getBaseBitsPerClick(),2)}`;
  multCur.textContent = `x${getClickPrestigeMultiplier().toFixed(2)}`;
  const prestigeCost = getPrestigeCost();
  if (Math.floor(count) >= prestigeCost) {
    prestigeBtn.style.display = 'inline-block';
    prestigeBtn.textContent = `Prestige (requires ${prestigeCost.toLocaleString()} clicks)`;
    prestigeBtn.classList.add('prestige-ready');
  } else {
    prestigeBtn.style.display = 'none';
    prestigeBtn.classList.remove('prestige-ready');
  }
  updateAchievementsPanel();
  updateStatsPanel();
  renderShopInner();
  renderPrestigeShop();
  qbitsCur.textContent = `QBits: ${fmt(qbits)}`;
}

/* ------------------------------
   CHECK ACHIEVEMENTS after increment
   ------------------------------ */
function checkAchievementsAfterIncrement() {
  const cur = Math.floor(count);
  let any = false;
  const keys = Object.keys(achievements).map(k=>parseInt(k)).sort((a,b)=>a-b);
  for (const k of keys) {
    const key = String(k);
    if (cur >= k && !unlocked.includes(key)) {
      unlocked.push(key);
      any = true;
      const secret = achievements[key].secret === true;
      showToast('Achievement Earned!', achievements[key].text, secret);
    }
  }
  if (any) saveUnlocked();
}

/* ------------------------------
   OFFLINE GAIN (incorporates timeDistorter)
   ------------------------------ */
function handleOfflineGain() {
  const now = Date.now();
  const secsAway = Math.floor((now - lastPlayed) / 1000);
  if (secsAway < 5) {
    lastPlayed = now;
    localStorage.setItem('lastPlayed', String(lastPlayed));
    return;
  }
  const baseClicks = Math.floor(secsAway / 5);
  const multiplier = 1 + (upgrades.energy || 0);
  const timeDistorterMult = 1 + (prestigeLevel('timeDistorter') || 0) * 0.25;
  const offlineClicks = Math.floor(baseClicks * multiplier * timeDistorterMult);
  if (offlineClicks <= 0) { lastPlayed = now; localStorage.setItem('lastPlayed', String(lastPlayed)); return; }
  const clicksGained = offlineClicks * getClickPower();
  const bitsGained = offlineClicks * getBaseBitsPerClick();
  count += clicksGained;
  totalClicks += clicksGained;
  bits += bitsGained;
  totalBitsEarned += bitsGained;
  offlineClicksEarned += offlineClicks;
  lastPlayed = now;
  localStorage.setItem('lastPlayed', String(lastPlayed));
  saveAll();
  showToast('Welcome back!', `You earned ${fmt(offlineClicks)} offline clicks (+${fmtFloat(bitsGained,2)} bits).`);
  checkAchievementsAfterIncrement();
}

/* ------------------------------
   CLICK HANDLER
   ------------------------------ */
clickBtn.addEventListener('click', () => {
  const clickGain = getClickPower();
  count += clickGain;
  totalClicks += clickGain;
  const bitsGained = getBaseBitsPerClick();
  bits += bitsGained;
  totalBitsEarned += bitsGained;
  saveAll();
  checkAchievementsAfterIncrement();
  refreshUI();
});

/* ------------------------------
   PRESTIGE (awards flat QBits)
   ------------------------------ */
prestigeBtn.addEventListener('click', ()=>{
  const req = getPrestigeCost();
  if (Math.floor(count) < req) return;
  if (!confirm(`Prestiging resets current clicks, Bits and run-only upgrades but grants permanent QBits (and increases prestige level). Proceed?`)) return;
  prestigeCount++;
  // award flat QBits per prestige
  qbits += QBITS_PER_PRESTIGE;
  // reset run-specific stuff
  count = 0;
  bits = 0;
  upgrades = { finger:0, mouse:0, energy:0, magnet:0, turbo:0, factory:0, bank:0 };
  stopAutoClicker();
  saveAll();
  saveUnlocked();
  showToast('Prestige!', `You prestiged. Prestige level: ${prestigeCount}. Awarded ${QBITS_PER_PRESTIGE} QBits.`, true);
  refreshUI();
});

/* ------------------------------
   RESET (clear everything)
   ------------------------------ */
resetBtn.addEventListener('click', ()=>{
  if (!confirm('Erase ALL progress (clicks, bits, prestige, upgrades)?')) return;
  localStorage.clear();
  count=0; totalClicks=0; bits=0; totalBitsEarned=0; bitsSpent=0; unlocked=[]; prestigeCount=0;
  upgrades={finger:0,mouse:0,energy:0,magnet:0,turbo:0,factory:0,bank:0}; savedPlaytime=0; sessionStart=Date.now(); lastPlayed=Date.now(); offlineClicksEarned=0;
  qbits = 0;
  prestigeUpgrades = {};
  stopAutoClicker();
  showToast('Reset', 'All progress erased.');
  refreshUI();
});

/* ------------------------------
   PANELS open/close
   ------------------------------ */
achBtn.addEventListener('click', ()=>{ achPanel.classList.toggle('show'); achPanel.setAttribute('aria-hidden', !achPanel.classList.contains('show')); updateAchievementsPanel(); });
closeAch.addEventListener('click', ()=>{ achPanel.classList.remove('show'); achPanel.setAttribute('aria-hidden','true'); });

upgBtn.addEventListener('click', ()=>{ upgPanel.classList.toggle('show'); upgPanel.setAttribute('aria-hidden', !upgPanel.classList.contains('show')); renderShopInner(); });
closeUpg.addEventListener('click', ()=>{ upgPanel.classList.remove('show'); upgPanel.setAttribute('aria-hidden','true'); });

prestigeUpgBtn.addEventListener('click', ()=>{ prestigePanel.classList.toggle('show'); prestigePanel.setAttribute('aria-hidden', !prestigePanel.classList.contains('show')); renderPrestigeShop(); });
closePrestige.addEventListener('click', ()=>{ prestigePanel.classList.remove('show'); prestigePanel.setAttribute('aria-hidden','true'); });

statsBtn.addEventListener('click', ()=>{ statsPanel.classList.toggle('show'); statsPanel.setAttribute('aria-hidden', !statsPanel.classList.contains('show')); updateStatsPanel(); });
closeStats.addEventListener('click', ()=>{ statsPanel.classList.remove('show'); statsPanel.setAttribute('aria-hidden','true'); });

/* ------------------------------
   SHOP and save on unload
   ------------------------------ */
document.addEventListener('touchstart', function(e){ if (e.target.tagName === 'BUTTON') { e.preventDefault(); e.target.click(); } }, { passive:false });

window.addEventListener('beforeunload', ()=>{
  const now = Date.now();
  const sess = now - sessionStart;
  savedPlaytime += sess;
  localStorage.setItem('savedPlaytime', String(savedPlaytime));
  lastPlayed = now;
  localStorage.setItem('lastPlayed', String(lastPlayed));
  saveAll();
});

/* ------------------------------
   ON LOAD: run setup
   ------------------------------ */
window.addEventListener('load', ()=>{
  if (!firstSeen) { 
    firstSeen = Date.now(); 
    localStorage.setItem('firstSeen', String(firstSeen)); 
  }
  handleOfflineGain();

  // ✅ Fix legacy saves (add qBits for old prestiges)
  if (prestigeCount > 0 && (typeof qbits === "undefined" || qbits === null)) {
    qbits = prestigeCount * 2; // give 2 qBits per prestige level
  }

  if ((upgrades.energy || 0) > 0 || (upgrades.factory || 0) > 0) startAutoClicker();
  autoUnlockExisting();
  refreshUI();
});
/* ------------------------------
   STATS HELPERS
   ------------------------------ */
function countOwnedUpgrades() {
  return (upgrades.finger||0) + (upgrades.mouse||0) + (upgrades.energy||0) + (upgrades.magnet||0) + (upgrades.turbo||0) + (upgrades.factory||0) + (upgrades.bank||0);
}
function updateStatsPanel() {
  statTotal.textContent = Math.floor(totalClicks).toLocaleString();
  statBits.textContent = Math.floor(totalBitsEarned).toLocaleString();
  statPrestige.textContent = prestigeCount;
  statUpgrades.textContent = countOwnedUpgrades();
  const now = Date.now();
  const playMs = savedPlaytime + (now - sessionStart);
  const s = Math.floor(playMs/1000), h = Math.floor(s/3600), m = Math.floor((s%3600)/60), sec = s%60;
  statPlaytime.textContent = h ? `${h}h ${m}m ${sec}s` : (m ? `${m}m ${sec}s` : `${sec}s`);
}

/* ------------------------------
   INIT
   ------------------------------ */
renderShopInner();
renderPrestigeShop();
refreshUI();
</script>
</body>
</html>
